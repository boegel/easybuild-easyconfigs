easyblock = 'Binary'

name = 'Livy'
version = '0.6.0'
versionsuffix = '-Python-%(pyver)s'

homepage = 'https://livy.apache.org'
description = "Apache Livy is a REST service for Apache Spark"

toolchain = {'name': 'foss', 'version': '2018b'}

source_urls = [
    'https://www-eu.apache.org/dist/incubator/livy/%(version)s-incubating/',
    'https://www-us.apache.org/dist/incubator/livy/%(version)s-incubating/',
]
sources = ['apache-livy-%(version)s-incubating-src.zip']
checksums = ['0061f8f6db2da498318019210e5d515183db3706095277a2e05c38db0baf77bb']

builddependencies = [
    ('Maven', '3.6.0', '', True),
    ('pytest', '4.4.0', versionsuffix),
    ('R', '3.5.1', versionsuffix),
]

dependencies = [
    ('Java', '1.8', '', True),
    ('Python', '2.7.15'),
    ('Spark', '2.4.0', versionsuffix),
]

extract_sources = True

install_cmd = "mvn package -T%(parallel)s && "
install_cmd += "unzip assembly/target/apache-%(namelower)s-%(version)s-incubating-bin.zip && "
install_cmd += "cp -av apache-%(namelower)s-%(version)s-incubating-bin/* %(installdir)s"

sanity_check_paths = {
    'files': ['bin/livy-server'],
    'dirs': [],
}

moduleclass = 'tools'
